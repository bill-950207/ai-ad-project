# AIAD 크레딧 시스템 가이드

> 마지막 업데이트: 2026-01-29

## 개요

AIAD 크레딧은 AI 기능 사용에 소비되는 가상 화폐입니다.

- **크레딧 단가**: 약 100원 (~$0.07) / 크레딧
- **신규 가입 지급**: 15 크레딧
- **DB 필드**: `profiles.credits`

---

## 기능별 크레딧 비용

### 1. 이미지 생성 (0-3 크레딧)

| 기능 | 크레딧 | AI 모델 | 비고 |
|------|--------|---------|------|
| **아바타 생성** | 0 | Kie.ai Z-Image | 무료 (신규 사용자 유치) |
| **배경 제거** | 0 | Kie.ai Recraft | 무료 |
| **배경 이미지 생성** | 1 | Kie.ai Z-Image | ~$0.02 |
| **제품 등록** | 1 | - | 배경 제거 포함 |
| **이미지 광고 (Medium)** | 2 | Kie.ai Seedream 4.5 | ~$0.05 |
| **이미지 광고 (High)** | 3 | Kie.ai Seedream 4.5 | ~$0.08 |
| **키프레임 이미지** | 1 | Seedream 4.5 | 장당 ~$0.03 |

### 2. 오디오 생성 (0-1 크레딧)

| 기능 | 크레딧 | AI 모델 | 비고 |
|------|--------|---------|------|
| **TTS 음성** | 0 | WaveSpeed Minimax | 무료 (영상 워크플로우 포함) |
| **음악 생성** | 1 | Kie.ai Suno V5 | ~$0.03 |

### 3. 영상 생성 - 제품 광고

#### Seedance 모델 (4K 지원)

| 길이 | 크레딧 | 실제 비용 |
|------|--------|----------|
| 4초 | 8 | ~$0.30 |
| 8초 | 12 | ~$0.50 |
| 12초 | 16 | ~$0.70 |

#### Wan 2.6 모델

| 길이 | 크레딧 | 실제 비용 |
|------|--------|----------|
| 5초 | 10 | ~$0.40 |
| 10초 | 15 | ~$0.60 |
| 15초 | 20 | ~$0.80 |

### 4. 영상 생성 - Vidu Q2 (초당 과금)

| 해상도 | 크레딧/초 | 10초 기준 |
|--------|----------|----------|
| 540p (SD) | 1 | 10 크레딧 |
| 720p (HD) | 2 | 20 크레딧 |
| 1080p (FHD) | 3 | 30 크레딧 |

> Vidu Q2는 제품 광고 씬별 영상에서 사용됩니다.

### 5. 영상 생성 - 기타

| 기능 | 크레딧 | AI 모델 | 비고 |
|------|--------|---------|------|
| **씬 전환 영상** | 12 | FAL.ai Kling O1 | 전환당 ~$0.50 |
| **제품 설명 영상 (480p)** | 5 | Hailuo + TTS | 5초당 ~$0.15 |
| **제품 설명 영상 (720p)** | 10 | Hailuo + TTS | 5초당 ~$0.30 |

---

## 무료 기능

| 기능 | 설명 |
|------|------|
| 아바타 생성 | 신규 사용자 유치 목적 |
| 배경 제거 | Kie.ai Recraft 사용 |
| TTS 음성 생성 | 영상 워크플로우에 포함 |
| 영상 병합 | FFmpeg 서버 처리 |

---

## 영상 워크플로우별 총 크레딧

### 제품 광고 영상 (Product-Ad)

```
Step 5: 키프레임 생성
  └─ 1크레딧 × 씬 개수

Step 6: 영상 생성
  ├─ 씬별 영상: 8~20크레딧 × 씬 개수 (또는 Vidu 초당 과금)
  └─ 씬 전환: 12크레딧 × (씬 개수 - 1)
```

**예시: 4씬 영상 (Wan 2.6, 5초/씬)**

| 단계 | 계산 | 크레딧 |
|------|------|--------|
| 키프레임 | 1 × 4 | 4 |
| 씬 영상 | 10 × 4 | 40 |
| 씬 전환 | 12 × 3 | 36 |
| **합계** | | **80** |

### 제품 설명 영상 (토킹)

```
TTS 음성 생성: 0 (무료)
토킹 영상 생성: 5~10크레딧 (해상도별)
```

---

## 구독 플랜

| 플랜 | 월간 크레딧 | 월 가격 | 연 가격 | 아바타 | 음악 | 제품 |
|------|------------|--------|--------|--------|------|------|
| **FREE** | 15 (1회) | $0 | $0 | 3개 | 5개 | 3개 |
| **STARTER** | 120 | $9.99 | $99.90 | 9개 | 15개 | 9개 |
| **PRO** | 420 | $29.99 | $299.90 | 30개 | 50개 | 30개 |
| **BUSINESS** | 1,600 | $99.99 | $999.90 | 무제한 | 무제한 | 무제한 |

### 크레딧 예상 사용량

| 플랜 | 이미지 광고 | 영상 광고 |
|------|-----------|----------|
| FREE | ~7개 | - |
| STARTER | ~60개 | ~12개 |
| PRO | ~210개 | ~42개 |
| BUSINESS | ~800개 | ~160개 |

### 플랜별 특별 기능

| 기능 | FREE | STARTER | PRO | BUSINESS |
|------|------|---------|-----|----------|
| 워터마크 제거 | ❌ | ✅ | ✅ | ✅ |
| HD 업스케일 | ❌ | ✅ | ✅ | ✅ |
| High 품질 이미지 | ❌ | ❌ | ✅ | ✅ |
| 이미지 동시 생성 | 1장 | 5장 | 5장 | 5장 |
| 영상 동시 생성 | - | 1개 | 3개 | 3개 |
| API 액세스 | ❌ | ❌ | ❌ | ✅ |

---

## API 크레딧 차감 목록

| API 엔드포인트 | 크레딧 | 조건 |
|----------------|--------|------|
| `POST /api/avatars` | 0 | 무료 |
| `POST /api/image-ads` | 2~3×N | 품질별 |
| `POST /api/image-ads/[id]/edit` | 2~3 | 품질별 |
| `POST /api/ad-products` | 1 | 항상 |
| `POST /api/ad-music` | 1 | 항상 |
| `POST /api/ad-backgrounds` | 1 | 항상 |
| `POST /api/product-ad/generate-keyframes` | 1×N | 장당 |
| `POST /api/product-ad/generate-video` | 8~20×M | 모델/길이별 |
| `POST /api/product-ad/generate-scene-videos` | 1~3×초×M | Vidu 해상도별 |
| `POST /api/product-ad/generate-transitions` | 12×N | 전환당 |
| `POST /api/video-ads/product-description/generate-video` | 5~10 | 480p/720p |

*N = 씬/이미지 개수, M = 배치 영상 개수*

---

## 크레딧 차감 메커니즘

### 트랜잭션 처리

모든 크레딧 차감은 Prisma 트랜잭션으로 원자적 처리:

```typescript
await prisma.$transaction(async (tx) => {
  // 1. 크레딧 재확인 (동시성 문제 해결)
  const currentProfile = await tx.profiles.findUnique({
    where: { id: user.id },
    select: { credits: true },
  })

  // 2. 잔액 체크
  if (!currentProfile || (currentProfile.credits ?? 0) < totalCreditCost) {
    throw new Error('INSUFFICIENT_CREDITS')
  }

  // 3. 원자적 차감
  await tx.profiles.update({
    where: { id: user.id },
    data: { credits: { decrement: totalCreditCost } },
  })
})
```

### 크레딧 부족 응답

```json
{
  "error": "Insufficient credits",
  "required": 10,
  "available": 5
}
```

- **HTTP Status**: 402 Payment Required

---

## 크레딧 환불

실패한 작업(FAILED 상태)은 자동 환불:

| 기능 | 환불 API |
|------|----------|
| 이미지 광고 | `POST /api/image-ads/[id]/refund` |

```typescript
await tx.profiles.update({
  where: { id: user.id },
  data: { credits: { increment: refundAmount } },
})
```

---

## 월간 크레딧 갱신

- **타이밍**: 매월 구독 갱신 시점
- **금액**: 플랜의 `monthly_credits` 값
- **처리 방식**:
  - Stripe 웹훅 (`/api/stripe/webhooks`)
  - 크론 작업 (`/api/cron/monthly-credits`)

---

## 실제 사용 예시

### FREE 플랜 사용자 (15 크레딧, 1회 지급)

| 작업 | 크레딧 | 누적 소비 | 잔여 |
|------|--------|----------|------|
| 이미지 광고 3개 (Medium) | 6 | 6 | 9 |
| 제품 등록 2개 | 2 | 8 | 7 |
| 배경 이미지 3개 | 3 | 11 | 4 |
| 음악 생성 4개 | 4 | 15 | 0 |

### STARTER 플랜 사용자 (월 120 크레딧)

| 작업 | 크레딧 | 누적 소비 | 잔여 |
|------|--------|----------|------|
| 이미지 광고 30개 (Medium) | 60 | 60 | 60 |
| 제품 광고 3개 (Seedance 8초) | 36 | 96 | 24 |
| 음악 생성 10개 | 10 | 106 | 14 |
| 배경 이미지 14개 | 14 | 120 | 0 |

### PRO 플랜 사용자 (월 420 크레딧)

| 작업 | 크레딧 | 누적 소비 | 잔여 |
|------|--------|----------|------|
| 이미지 광고 50개 (High) | 150 | 150 | 270 |
| 제품 광고 10개 (Wan 10초) | 150 | 300 | 120 |
| 제품 설명 영상 8개 (720p) | 80 | 380 | 40 |
| 음악 생성 40개 | 40 | 420 | 0 |

### BUSINESS 플랜 사용자 (월 1,600 크레딧)

| 작업 | 크레딧 | 누적 소비 | 잔여 |
|------|--------|----------|------|
| 이미지 광고 100개 (High) | 300 | 300 | 1,300 |
| 제품 광고 50개 (Wan 10초) | 750 | 1,050 | 550 |
| Vidu 영상 15개 (10초, 720p) | 300 | 1,350 | 250 |
| 제품 설명 영상 25개 (720p) | 250 | 1,600 | 0 |

---

## 관련 파일

| 파일 | 설명 |
|------|------|
| `lib/credits/constants.ts` | 크레딧 비용 상수 정의 |
| `prisma/schema.prisma` | profiles, plans, subscriptions 스키마 |
| `scripts/seed-plans.ts` | 플랜 데이터 시드 |
| `contexts/credit-context.tsx` | 클라이언트 크레딧 상태 관리 |
| `components/ui/insufficient-credits-modal.tsx` | 크레딧 부족 모달 |
